DROP DATABASE EMARTDB;
CREATE DATABASE EMARTDB;
USE EMARTDB;

CREATE TABLE USERS(
    UID NUMERIC NOT NULL UNIQUE PRIMARY KEY,
    UNM VARCHAR(30) NOT NULL,
    PWD VARCHAR(16000) NOT NULL,
    ROLE VARCHAR(30) NOT NULL
);

CREATE TABLE BUYERS(
    BRID INT PRIMARY KEY UNIQUE AUTO_INCREMENT,
    FNM VARCHAR(30) NOT NULL,
    LNM VARCHAR(30) NOT NULL,
    EML VARCHAR(30) NOT NULL,
    MBL VARCHAR(10) NOT NULL,
    CRDT DATE NOT NULL,
    ADD1 VARCHAR(30) NOT NULL,
    ADD2 VARCHAR(30) NOT NULL,
    CITY VARCHAR(20) NOT NULL,
    STATE VARCHAR(20) NOT NULL,
    PINC CHAR(6) NOT NULL,
    UID INT REFERENCES USERS(UID)
);

CREATE TABLE SELLERS(
    SRID INT PRIMARY KEY UNIQUE AUTO_INCREMENT,
    FNM VARCHAR(30) NOT NULL,
    LNM VARCHAR(30) NOT NULL,
    EML VARCHAR(30) NOT NULL,
    PHN VARCHAR(10) NOT NULL,
    CMPNM varchar(20) NOT NULL,
	ADD1 varchar(20) NOT NULL,
    ADD2 VARCHAR(30) NOT NULL,
    CITY VARCHAR(20) NOT NULL,
    STATE VARCHAR(20) NOT NULL,
    PINC CHAR(6) NOT NULL,
	WBST VARCHAR(40) NOT NULL,
    UID INT REFERENCES USERS(UID)
);

CREATE TABLE DISCOUNTS(
    DSID INT PRIMARY KEY UNIQUE,
    PRCNT INT UNIQUE,
    SDT DATE,
    EDT DATE,
    MAXC INT,
    DSON VARCHAR(20) NOT NULL
);

CREATE TABLE CATEGORIES(
    CTID INT PRIMARY KEY UNIQUE AUTO_INCREMENT,
    NAME VARCHAR(20) NOT NULL,
    GST NUMERIC NOT NULL,
    DSC VARCHAR(2000) NOT NULL
);

CREATE TABLE SUBCATEGORIES(
    SCID INT PRIMARY KEY UNIQUE AUTO_INCREMENT,
    NAME VARCHAR(20) NOT NULL,
    CTID INT REFERENCES CATEGORIES(CTID),
    DSC VARCHAR(2000) NOT NULL
);

CREATE TABLE ITEMS(
    ITID INT PRIMARY KEY UNIQUE AUTO_INCREMENT,
    NAME VARCHAR(20) NOT NULL,
    PRICE NUMERIC NOT NULL,
    DSC VARCHAR(2000) NOT NULL,
    QTY INT NOT NULL,
    SRID INT REFERENCES SELLERS(SRID),
    SCID INT REFERENCES SUBCATEGORIES(SCID)
);

CREATE TABLE BILLS(
    BLID INT PRIMARY KEY UNIQUE AUTO_INCREMENT,
    GTA NUMERIC NOT NULL,
    ITID INT REFERENCES ITEMS(ITID),
    DSID INT REFERENCES DISCOUNTS(DSID)
);

CREATE TABLE ORDERS(
    ODID INT PRIMARY KEY UNIQUE AUTO_INCREMENT,
    TXNID INT REFERENCES TRANSACTIONS(TXNID)
);

CREATE TABLE ODITEMS(
   ODID INT REFERENCES ORDERS(ODID),
   ITID INT REFERENCES ITEMS(ITID)
);

CREATE TABLE TRANSACTIONS(
    TXNID INT PRIMARY KEY UNIQUE AUTO_INCREMENT,
    AMT NUMERIC,
    DT_TM DATETIME,
    TYPE INT,
    UID INT REFERENCES USERS(UID),
    DSC VARCHAR(1000),
    BAL NUMERIC NOT NULL
);